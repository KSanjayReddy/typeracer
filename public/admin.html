<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="scripts/socket.io.js"></script>
    <script src="scripts/jquery-3.1.1.min.js"></script>
    <title>Type Racer</title>
  </head>
  <body>
    <input id='para' type="text" name="para" value="">
    <button onclick="set_paragraph()"type="button" name="submit">Submit Para</button>
    <button onclick='set_timer()' type="button" name="submit">Start Timer</button>
    <div id="timer"></div>
    <div id="game"></div>

    <script type="text/javascript">
      var socket = io();
      socket.on('msg', function (data) {
        $("#chats").prepend(data+"<br>")
      });

      var set_timer = function(){
        socket.emit('set_timer');
      }
      var set_paragraph = function(){
        socket.emit('set_paragraph',$('#para').val())
      }
      socket.on('timer_is_set', function (data) {
        initializeClock('timer',data)
      });

      socket.on('start_game', function (data) {
        $("#game").html(data)
      });

      var getTimeRemaining = function(endtime){
        var now = new Date();
        var t = Date.parse(endtime) - Date.parse(now);
        var seconds = Math.floor( (t/1000) % 60 );
        var minutes = Math.floor( (t/1000/60) % 60 );
        var hours = Math.floor( (t/(1000*60*60)) % 24 );
        var days = Math.floor( t/(1000*60*60*24) );

        if(t<=0){
          return {
            'total': 0,
            'days': 0,
            'hours': 0,
            'minutes': 0,
            'seconds': 0
          };
        }else{
          return {
            'total': t,
            'days': days,
            'hours': hours,
            'minutes': minutes,
            'seconds': seconds
          };
        }
      }

      function initializeClock(id, endtime){
        var clock = document.getElementById(id);
        function updateClock(){
          var t = getTimeRemaining(endtime);

          clock.innerHTML =
                            ('0' + t.hours).slice(-2) + ':' +
                            ('0' + t.minutes).slice(-2) + ':' +
                           ('0' + t.seconds).slice(-2);
          if(t.total<=0){
            clearInterval(timeinterval);
          }
        }
        updateClock()
        var timeinterval = setInterval(updateClock,1000);
      }
      // var t = new Date();
      // t.setSeconds(t.getSeconds() + 10);
      // initializeClock('timer',t)
    </script>
  </body>
</html>
