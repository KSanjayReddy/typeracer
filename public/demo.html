<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="scripts/socket.io.js"></script>
    <script src="scripts/jquery-3.1.1.min.js"></script>
    <title>Type Racer</title>
  </head>
  <body>
    <div id="chats"></div>
    <input type="text" placeholder="Say Something!" id="msg"/>
    <button onclick='send()' type="button" name="submit">Send</button>
    <div id="timer">

    </div>
    <script type="text/javascript">
      var socket = io.connect('http://localhost:3000');
      socket.on('msg', function (data) {
        $("#chats").prepend(data+"<br>")
      });

      var send = function(){
        socket.emit('msg', $("#msg").val());
      }

      socket.on('timer_is_set', function (data) {
        initializeClock('timer',data)
      });

      socket.on('start_game', function (data) {
        $("#timer").html("Game has started")
      });

      var getTimeRemaining = function(endtime){
        var now = new Date();
        var t = Date.parse(endtime) - Date.parse(now);
        var seconds = Math.floor( (t/1000) % 60 );
        var minutes = Math.floor( (t/1000/60) % 60 );
        var hours = Math.floor( (t/(1000*60*60)) % 24 );
        var days = Math.floor( t/(1000*60*60*24) );

        if(t<=0){
          return {
            'total': 0,
            'days': 0,
            'hours': 0,
            'minutes': 0,
            'seconds': 0
          };
        }else{
          return {
            'total': t,
            'days': days,
            'hours': hours,
            'minutes': minutes,
            'seconds': seconds
          };
        }
      }

      function initializeClock(id, endtime){
        var clock = document.getElementById(id);
        function updateClock(){
          var t = getTimeRemaining(endtime);

          clock.innerHTML =
                            ('0' + t.hours).slice(-2) + ':' +
                            ('0' + t.minutes).slice(-2) + ':' +
                           ('0' + t.seconds).slice(-2);
          if(t.total<=0){
            clearInterval(timeinterval);
          }
        }
        updateClock()
        var timeinterval = setInterval(updateClock,1000);
      }
      // var t = new Date();
      // t.setSeconds(t.getSeconds() + 10);
      // initializeClock('timer',t)
    </script>
  </body>
</html>
